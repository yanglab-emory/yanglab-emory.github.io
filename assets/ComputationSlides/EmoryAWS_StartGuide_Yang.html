<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>EmoryAWS_StartGuide_Yang</title>


<style type="text/css">
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA09pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoMTMuMCAyMDEyMDMwNS5tLjQxNSAyMDEyLzAzLzA1OjIxOjAwOjAwKSAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUM2NjlDQjI4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUM2NjlDQjM4ODBGMTFFMTg1ODlEODNERDJBRjUwQTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QzY2OUNCMDg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QzY2OUNCMTg4MEYxMUUxODU4OUQ4M0REMkFGNTBBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsQhXeAAAABfSURBVHjaYvz//z8DJYCRUgMYQAbAMBQIAvEqkBQWXI6sHqwHiwG70TTBxGaiWwjCTGgOUgJiF1J8wMRAIUA34B4Q76HUBelAfJYSA0CuMIEaRP8wGIkGMA54bgQIMACAmkXJi0hKJQAAAABJRU5ErkJggg==) no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0;
}

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }
li {
  margin: 0; }
ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0;border-collapse: collapse; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

.highlight pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }

pre {
  background-color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

sup {
    font-size: 0.83em;
    vertical-align: super;
    line-height: 0;
}

kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb
}

* {
	-webkit-print-color-adjust: exact;
}
@media screen and (min-width: 914px) {
    body {
        width: 854px;
        margin:0 auto;
    }
}
@media print {
	table, pre {
		page-break-inside: avoid;
	}
	pre {
		word-wrap: break-word;
	}
  body {
    padding: 2cm; 
  }
}
</style>


</head>

<body>

<h1 id="toc_0">Introduction to Emory AWS</h1>

<h2 id="toc_1">Login to Emory AWS</h2>

<ul>
<li>First login to <strong><a href="https://vpn.emory.edu/">Emory VPN</a></strong> even if you are using Emory Network<br></li>
<li>Login to <strong><a href="https://aws.emory.edu/">Emory AWS Console</a></strong> with your Emory ID and password

<ul>
<li><code>aws-account-115</code> is our lab account</li>
</ul></li>
</ul>

<h2 id="toc_2">AWS Service and Help</h2>

<ul>
<li><strong>AWS Service</strong> : Search <strong>Find Services</strong>

<ul>
<li><strong>EC2 to initiate instance</strong></li>
<li><strong>S3 for storage</strong></li>
</ul></li>
<li><strong>Choose N. Virginia for your Default Working Region</strong>
<img src="./Figs/aws_management_console.png" alt=""></li>
</ul>

<h2 id="toc_3">Identity Access Management (IAM)</h2>

<h3 id="toc_4">Configure role for access between AWS resources, e.g., allowing EC2 instance to access S3 bucket (<code>EC2toS3Full</code>).</h3>

<h3 id="toc_5">Create IAM</h3>

<ul>
<li>Select <strong><code>IAM Service</code></strong></li>
<li>Click: <strong><code>Dashboard/Access management/Roles</code></strong></li>
<li>Select <strong><code>Create Role</code></strong>: 

<ul>
<li>Choose a use case (EC2)</li>
<li>Select policy, e.g., <code>AmazonS3FullAccess</code></li>
<li>Tag is optional</li>
<li>Select an informative name, e.g., <code>ec2-to-s3</code></li>
<li>Create role</li>
</ul></li>
</ul>

<h3 id="toc_6">Attach IAM roles</h3>

<p><img src="./Figs/Attach_IAM_Role.png" alt=""></p>

<h2 id="toc_7">EC2 Instance</h2>

<h3 id="toc_8">Lauch EC2 Instance</h3>

<p><img src="./Figs/launch_EC2.png" alt=""></p>

<ol>
<li><strong>Choose an Amazon Machine Image (AMI)</strong>. Select <strong>Amazon Linux 2 AMI</strong> (Free tier eligible) if you do not have one of your own AMI to choose</li>
<li><strong>Choose an Instance Type</strong> according to your need of the number of CPU cores and memory

<ul>
<li>Select <strong>t2.micro</strong> (Free tier eligible) or <strong>t2.medium</strong> for your practice</li>
<li>Select instance with enough memory for your own needs</li>
<li>See other instance types and pricing: <a href="https://aws.amazon.com/ec2/instance-types/">AWS Instance Types</a>
<img src="./Figs/instance.png" alt=""></li>
</ul></li>
<li><strong>Configure Instance Details</strong>

<ul>
<li>Network: <code>RHEDCloud VPC</code></li>
<li>Subnet: Select <code>Private Subnet 1 | us-east-1a</code> (<strong>note that you do not have permission to use the default one that is IT only</strong>)</li>
<li>Auto-assign <strong>Public IP</strong>: Use subnet setting (Disable)</li>
<li>IAM role: select one you created before</li>
<li>User data (optional)
<img src="./Figs/launch_EC2_example.png" alt="">
<img src="./Figs/launch_EC2_example2.png" alt=""></li>
</ul></li>
<li><strong>Add Storage</strong>. Storage can also be added after your instance is created but can not be reduced. <strong>Start with what you need.</strong></li>
<li><strong>Add Tags</strong> (optional)</li>
<li><strong>Configure Security Group</strong>

<ul>
<li>Select an existing security group: <code>EmoryIP</code></li>
<li>Select default<br></li>
</ul></li>
<li><p><strong>Private Key pair (<code>*.pem</code>)</strong> is needed to login to the EC2 instance. </p>

<ul>
<li><strong>Create a new private key pair for the first time</strong></li>
<li>Save the key pair in a safe and convenient place (home directory is recomended) on your local computer</li>
<li>Need to change permissions to private</li>
</ul>

<div><pre><code class="language-none">cd ~/Downloads
chmod 400 *.pem</code></pre></div>

<p><img src="./Figs/launch_EC2_example3.png" alt=""></p></li>
<li><p><strong>Launch Instance</strong></p></li>
<li><p><strong>Review Instance Launch</strong>
<img src="./Figs/launch_EC2_example4.png" alt=""></p></li>
</ol>

<h3 id="toc_9">Login to EC2 Instance</h3>

<ol>
<li>Go to view your instance</li>
<li>Click <code>Actions/Connect</code></li>
<li>Use the <code>ssh</code> command to connect</li>
<li>Need to have <code>*.pem</code> under the current directory
<img src="./Figs/Login_EC2.png" alt=""></li>
</ol>

<h3 id="toc_10">Change Instance Type to Add Memory/Storage</h3>

<ol>
<li>First <strong>STOP</strong> you current instance</li>
<li>Take a <strong>Snapshot</strong> of your current EBS (Elastic Block Store) or create an image</li>
<li><strong>Change Instance Type</strong> by clicking <code>Actions/Instance Settings/Change Instance Type</code>
<img src="./Figs/Add_memory_disk_space.png" alt=""></li>
</ol>

<h3 id="toc_11">Create Amazon Machine Image (AMI) for Your Current Instance</h3>

<ol>
<li><strong>Stop your instance</strong></li>
<li><strong>Select <code>Instance/Actions/Image/Create Image</code></strong>
<img src="./Figs/Create_AMI.png" alt=""></li>
</ol>

<h3 id="toc_12">AMI vs. Snapshot</h3>

<ol>
<li>A <strong>Snapshot</strong> is a backup copy of any EBS volume, and is saved in S3 storage.</li>
<li>An <strong>AMI</strong> is a snapshot of an EBS volume with an Operating System on it. It is, technically, the same kind of snapshot as above, but it has also been registered with the EC2 service as an AMI, usable to launch new EC2 instances.</li>
</ol>

<h2 id="toc_13">S3 Storage</h2>

<p><strong>S3 Storage is a preferred place to store frequently used data.</strong> </p>

<ul>
<li>Create a bucket with a universal unique name (across the whole AWS website)</li>
<li>Make sure you attached the <strong><code>EC2 access S3 IAM role</code></strong> to your EC2 instance</li>
<li>In your terminal that is connected to the EC2 instance, you can access S3 storage by comands starting with  <code>aws s3</code>, e.g., <code>aws s3 ls</code>.</li>
<li>Delete data from S3 Storage when no longer needed. Only store frequently used files, as we starts to pay when files are uploaded to S3. </li>
</ul>

<h2 id="toc_14">Install Software</h2>

<h3 id="toc_15">R/RStudio</h3>

<h4 id="toc_16">Installation</h4>

<ul>
<li>Use the package installation tool <code>yum</code> for this Linux/RedHat system: <code>sudo yum install [package name]</code>

<ul>
<li>Uninstall a package: <code>sudo yum erase [package name]</code></li>
<li>Ensure compilers and build tools are installed (these should have been installed for this AMI): <code>sudo yum groupinstall -y ‘Development Tools’</code><br></li>
</ul></li>
<li>Install common dependencies of R packages: <code>sudo yum install -y libcurl-devel openssl-devel libxml2-devel</code></li>
<li>Allow access to the Extra Packages for Enterprise Linux repository or EPEL:
<code>sudo yum install -y epel-release</code></li>
<li>Install R with <a href="https://blog.sellorm.com/2017/11/11/basic-installation-of-r-on-redhat-linux-7/">Detailed Instructions</a> :
<code>sudo yum install -y R</code></li>
<li><p><a href="https://www.rstudio.com/products/rstudio/download-server/redhat-centos/">Install Rstudio</a></p>

<div><pre><code class="language-none">wget https://download2.rstudio.org/server/centos7/x86_64/rstudio-server-rhel-2022.02.3-492-x86_64.rpm
sudo yum install rstudio-server-rhel-2022.02.3-492-x86_64.rpm</code></pre></div></li>
</ul>

<h4 id="toc_17">Login through browser to use R/RStudio</h4>

<ul>
<li>Make sure your EC2 instance is running</li>
<li>Attach IAM role to allow access from EC2 to S3 storage</li>
<li>Need to setup a user password (e.g., 123) for ec2-user: <code>sudo passwd ec2-user</code></li>
<li>Open your browser and type in <code>https://[private IP address]:8787</code></li>
<li>Login using user name <code>ec2-user</code> and the password you set up</li>
<li>Copy test data and R script from S3 storage to EC2 instance
<code>aws s3 cp s3://yanglab-at-emoryhg/rstudio-demo-script-data.zip ./
unzip rstudio-demo-script-data.zip</code></li>
</ul>

<p><img src="./Figs/Rstudio.png" alt=""></p>

<h2 id="toc_18">After Finish Your Work</h2>

<ol>
<li>Copy your <code>Outputs/Results</code> from EC2 instance to S3 storage or your local computer or HGCC. 
<code>aws s3 cp [directory/file] s3://yanglab-at-emoryhg/</code></li>
<li>Create an Image to save your working environment. Or create a Snapshot to save your current hard disk.

<ul>
<li>Create AMI or Snapshot along your work when you want to keep important work on the current instance, incase your instance crashes.</li>
</ul></li>
<li><strong>Terminate EC2 Instance. Please terminate all instances to avoid beeing charged in the background.</strong></li>
</ol>

<h2 id="toc_19">AWS Best Practices</h2>

<ul>
<li>  Save HIPAA Data, Emory Software, Credentials</li>
<li>  Shutdown EC2 Instances when you are not using them</li>
<li>  Security Groups</li>
<li>  Make use of S3 (cheaper than EBS (Elastic Block Store, attached to EC2 instance). Store all data in S3 and only create servers when needed for processing</li>
<li>  Use Spot/Reserved Instances (save up to 70% off on-demand costs)</li>
<li>  Budget Alerts (monitor your spend)</li>
</ul>

<h2 id="toc_20">Help</h2>

<ul>
<li><strong>AWS Support Center (HELP): The fastest way to get help</strong>

<ul>
<li>Knowledge Center</li>
<li>Create case to ask for help from AWS support</li>
<li>AWS provides 24hr online help</li>
</ul></li>
<li>Reach <strong>Emory AWS IT</strong> for Emory specific problems: <a href="mailto:aws.help@emory.edu">aws.help@emory.edu</a> </li>
</ul>

<h2 id="toc_21">Additional Resources</h2>

<ul>
<li><a href="https://it.emory.edu/aws-overview/resources.html"><strong>Additional Resources</strong></a></li>
<li><a href="https://emory.service-now.com/sp?id=search&amp;q=aws"><strong>Emory Knowledge Base</strong></a></li>
<li><a href="https://www.rhedcloud.org/pages/demos"><strong>AWS at Emory Demos</strong></a></li>
</ul>

<h3 id="toc_22">AWS Lambda</h3>

<p><img src="./Figs/aws_lambda.png" alt=""></p>




</body>

</html>
